<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>Leaf Health Dashboard</h2>
        </div>
        <ul class="sidebar-links">
            <li><a href="#section1">Upload Section</a></li>
            <li><a href="#section2">3D Leaf Viewer</a></li>
            <li><a href="#section3">AI Prediction</a></li>
            <li><a href="#section4">Data Log</a></li>
            <li><a href="#section5">Parameter Comparison</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <header>
            <h1>Interactive Dashboard</h1>
            <a href="../templates/mainpage.html" class="btn-primary">Home Page</a>
            <a href="../templates/allproducts.html" class="btn-primary">Explore Our Products</a>
            <a href="../templates/chatbot.html" class="btn-primary">Try  Vriksha GPT</a>
            <button class="theme-toggle">â˜¼/ðŸŒœï¸Žï¸Ž</button>
        </header>
        <div class="container">
            <!-- Upload Section -->
            <section id="section1">
                <h2>Upload Leaf Image</h2>
                <div class="upload-section">
                    <input type="file" id="imageUpload" accept="image/*" onchange="previewImage(event)">
                    <div id="dropzone" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">Drag and Drop Files Here</div>
                    <div id="imagePreview"></div>
                </div>
            </section>

            <!-- 3D Leaf Viewer -->
            <section id="section2">
                <h2>3D Leaf Viewer</h2>
                <div class="viewer-section">
                    <div id="leaf3d"></div>
                </div>
            </section>

            <!-- AI Prediction -->
            <section id="section3">
                <h2>AI Prediction</h2>
                <div class="ai-prediction">
                    <p>AI Prediction Result: <span id="aiPredictionBox">Data based on model analysis...</span></p>
                </div>
            </section>

            <!-- Data Log -->
            <section id="section4">
                <h2>Data Log</h2>
                <div class="data-log">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Moisture</th>
                                <th>Nutrients</th>
                                <th>Disease</th>
                            </tr>
                        </thead>
                        <tbody id="logTableBody">
                            <tr>
                                <td>2025-04-06</td>
                                <td>85%</td>
                                <td>72%</td>
                                <td>25%</td>
                            </tr>
                            <tr>
                                <td>2025-04-07</td>
                                <td>90%</td>
                                <td>80%</td>
                                <td>20%</td>
                            </tr>
                        </tbody>
                    </table>
                    <form id="logForm">
                        <input type="date" id="logDate" required>
                        <input type="number" id="logMoisture" placeholder="Moisture" required>
                        <input type="number" id="logNutrients" placeholder="Nutrients" required>
                        <input type="number" id="logDisease" placeholder="Disease" required>
                        <button type="submit">Add Log Entry</button>
                    </form>
                </div>
            </section>

            <!-- Parameter Comparison -->
            <section id="section5">
                <h2>Parameter Comparison</h2>
                <div class="comparison-cards">
                    <div class="param-card">
                        <strong>Growth Rate</strong>
                        <p>85%</p>
                    </div>
                    <div class="param-card">
                        <strong>Leaf Width</strong>
                        <p>15 cm</p>
                    </div>
                    <div class="param-card">
                        <strong>Sunlight Exposure</strong>
                        <p>High</p>
                    </div>
                </div>
            </section>

            <!-- Charts Section -->
            <section id="section6">
                <h2>Charts and Data Visualizations</h2>
                <div class="chart-container">
                    <canvas id="barChart"></canvas>
                    <canvas id="lineChart"></canvas>
                    <canvas id="radarChart"></canvas>
                </div>
            </section>
        </div>
    </div>

    <script src="../static/js/script.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        // Theme toggle function
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            if (document.body.classList.contains('dark-theme')) {
                localStorage.setItem('theme', 'dark');
            } else {
                localStorage.setItem('theme', 'light');
            }
        }

        // Check if a theme is saved and apply it on load
        window.addEventListener('load', function () {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
            }
        });

        // Handle image upload preview
        function previewImage(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            
            reader.onload = function () {
                const previewContainer = document.getElementById('imagePreview');
                const imgElement = document.createElement('img');
                imgElement.src = reader.result;
                imgElement.style.width = '100%';
                imgElement.style.borderRadius = '10px';
                previewContainer.innerHTML = '';
                previewContainer.appendChild(imgElement);
            };
            
            if (file) {
                reader.readAsDataURL(file);
            }
        }

        // Handle drag and drop functionality
        function handleDrop(event) {
            event.preventDefault();
            const file = event.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                
                reader.onload = function () {
                    const previewContainer = document.getElementById('imagePreview');
                    const imgElement = document.createElement('img');
                    imgElement.src = reader.result;
                    imgElement.style.width = '100%';
                    imgElement.style.borderRadius = '10px';
                    previewContainer.innerHTML = '';
                    previewContainer.appendChild(imgElement);
                };
                
                reader.readAsDataURL(file);
            }
        }

        // Add drag-over and drag-leave event listeners for better UX
        function handleDragOver(event) {
            event.preventDefault();
            document.getElementById('imagePreview').style.background = '#f0f0f0';
        }

        function handleDragLeave(event) {
            document.getElementById('imagePreview').style.background = '';
        }

        document.getElementById('imagePreview').addEventListener('dragover', handleDragOver);
        document.getElementById('imagePreview').addEventListener('dragleave', handleDragLeave);

        // Mock AI prediction logic
        function getAIPrediction() {
            const predictions = ['Healthy', 'Moderate', 'Diseased'];
            const prediction = predictions[Math.floor(Math.random() * predictions.length)];
            const aiPredictionBox = document.getElementById('aiPredictionBox');
            aiPredictionBox.innerHTML = `AI predicts: <strong>${prediction}</strong>`;
        }

        // Generate Mock Data for Charts
        function generateMockData() {
            const barChartData = {
                labels: ['Moisture', 'Nutrients', 'Disease'],
                datasets: [{
                    label: 'Health Parameters',
                    data: [80, 70, 30],
                    backgroundColor: ['#81c784', '#66bb6a', '#ff7043'],
                    borderColor: ['#388e3c', '#388e3c', '#d32f2f'],
                    borderWidth: 1
                }]
            };

            const lineChartData = {
                labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5'],
                datasets: [{
                    label: 'Moisture',
                    data: [80, 75, 78, 82, 80],
                    fill: false,
                    borderColor: '#388e3c',
                    tension: 0.1
                }]
            };

            const radarChartData = {
                labels: ['Moisture', 'Nutrients', 'Disease'],
                datasets: [{
                    label: 'Health Overview',
                    data: [80, 70, 30],
                    backgroundColor: 'rgba(129, 199, 132, 0.2)',
                    borderColor: '#388e3c',
                    borderWidth: 1
                }]
            };

            // Render charts
            renderCharts(barChartData, lineChartData, radarChartData);
        }

        // Function to render charts
        function renderCharts(barChartData, lineChartData, radarChartData) {
            const barChartCtx = document.getElementById('barChart').getContext('2d');
            new Chart(barChartCtx, {
                type: 'bar',
                data: barChartData
            });

            const lineChartCtx = document.getElementById('lineChart').getContext('2d');
            new Chart(lineChartCtx, {
                type: 'line',
                data: lineChartData
            });

            const radarChartCtx = document.getElementById('radarChart').getContext('2d');
            new Chart(radarChartCtx, {
                type: 'radar',
                data: radarChartData
            });
        }

        // Initialize the page
        window.addEventListener('load', function () {
            // Generate charts on page load
            generateMockData();

            // Generate AI prediction after a short delay
            setTimeout(getAIPrediction, 2000);
        });

        // Handle the submission of new log entries via form
        document.getElementById('logForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const date = document.getElementById('logDate').value;
            const moisture = document.getElementById('logMoisture').value;
            const nutrients = document.getElementById('logNutrients').value;
            const disease = document.getElementById('logDisease').value;
            addLogEntry(date, moisture, nutrients, disease);
        });

        // Add a new log entry
        function addLogEntry(date, moisture, nutrients, disease) {
            const logTableBody = document.getElementById('logTableBody');
            const newRow = document.createElement('tr');
            
            newRow.innerHTML = ` 
                <td>${date}</td>
                <td>${moisture}%</td>
                <td>${nutrients}%</td>
                <td>${disease}%</td>
            `;
            
            logTableBody.appendChild(newRow);
        }
    </script>
</body>

</html>
